{"ast":null,"code":"import React, { Component } from 'react';\nimport { predictCDA, predictPayload } from \"./predictions\";\nimport { getDirection } from \"./direction\";\nimport { predictLoc } from \"./location\";\nconst localServer = \"ws://localhost:8888\";\nconst remoteServer = \"ws://104.248.73.89:8888\"; // ?????\n\nconst server = remoteServer;\n\nclass WebSocketManager {\n  constructor() {\n    this.state = {\n      connected: false,\n      lastPacketTime: null,\n      currentData: null\n    };\n\n    this.connect = () => {\n      console.info(\"Connecting....\");\n      const connection = new WebSocket(server);\n\n      connection.onopen = () => {\n        this.setState({\n          connected: true\n        });\n        console.info(\"Connected to server\");\n      };\n\n      connection.onerror = error => {\n        console.error(\"Socket encountered error: \", error.message, \"Closing socket\");\n        connection.close();\n        console.info(\"Connection error\", error);\n      };\n\n      connection.onmessage = e => {\n        this.receiveData(e.data);\n      };\n\n      connection.onclose = () => {\n        console.info(\"Disconnected from server\");\n      };\n    };\n\n    this.receiveData = rawData => {\n      const currentData = this.state.currentData;\n      const data = JSON.parse(rawData);\n      const time = +Date.now();\n      const timeElapsed = time - this.state.lastPacketTime;\n      data.timeElapsed = timeElapsed;\n      this.state.lastPacketTime = time;\n\n      if (data.flightData) {\n        data.flightData.timeRecieved = time / 1000 || 0;\n        data.flightData.payloadPredictionDistance = predictPayload(data.flightData.altitude, data.flightData.velocity, data.flightData.headwind);\n        data.flightData.CDAPredictionDistance = predictCDA(data.flightData.altitude, data.flightData.velocity, data.flightData.headwind);\n        data.flightData.direction = getDirection(currentData.flightData, data.flightData);\n        data.flightData.payloadLatLong = predictLoc(data.flightData, data.flightData.payloadPredictionDistance);\n        data.flightData.cdaLatLong = predictLoc(data.flightData, data.flightData.CDAPredictionDistance);\n        this.planePositionHistory.push([data.flightData.latitude, data.flightData.longitude]);\n        this.dataLog.push(data.flightData);\n        this.setState({\n          currentData: data\n        });\n      }\n    };\n\n    this.testData = () => {\n      const connected = this.state.connected;\n\n      if (!connected) {\n        console.warn(\"Cannot send. Not connected\");\n        return;\n      }\n\n      const data = JSON.stringify({\n        type: \"data\",\n        flightData: {\n          latitude: 49.258063 + Math.random() * 0.00111,\n          longitude: -123.195911 + Math.random() * 0.00111,\n          altitude: 45.3,\n          velocity: 10.3,\n          headwind: -0.9\n        }\n      });\n      console.info(\"Sending test data:\", data);\n      this.connection.send(data);\n    };\n\n    this.ping = () => {\n      const connected = this.state.connected;\n\n      if (!connected) {\n        console.warn(\"Cannot ping. Not connected\");\n        return;\n      }\n\n      const message = JSON.stringify({\n        type: \"action\",\n        action: {// ping\n        }\n      });\n      console.info(\"Pinging:\", message);\n      this.connection.send(message);\n    };\n\n    this.release = () => {\n      const connected = this.state.connected;\n\n      if (!connected) {\n        console.warn(\"Cannot drop. Not connected\");\n        return;\n      }\n\n      const message = JSON.stringify({\n        type: \"action\",\n        action: {// drop details\n        }\n      });\n      console.info(\"Sending drop signal:\", message);\n      this.connection.send(message);\n    };\n\n    this.connect();\n  }\n\n  componentDidMount() {\n    this.connect();\n  }\n  /*\n    check = () => {\n      const { connection } = this.state;\n      if (!connection || connection.readyState == WebSocket.CLOSED) this.connect();\n    };\n    */\n\n\n}\n\nexport default WebSocketManager;","map":{"version":3,"sources":["C:/Users/James Pan/Desktop/demo/groundstationweb/src/helpers/WebSocketManager.jsx"],"names":["React","Component","predictCDA","predictPayload","getDirection","predictLoc","localServer","remoteServer","server","WebSocketManager","constructor","state","connected","lastPacketTime","currentData","connect","console","info","connection","WebSocket","onopen","setState","onerror","error","message","close","onmessage","e","receiveData","data","onclose","rawData","JSON","parse","time","Date","now","timeElapsed","flightData","timeRecieved","payloadPredictionDistance","altitude","velocity","headwind","CDAPredictionDistance","direction","payloadLatLong","cdaLatLong","planePositionHistory","push","latitude","longitude","dataLog","testData","warn","stringify","type","Math","random","send","ping","action","release","componentDidMount"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { predictCDA, predictPayload } from \"./predictions\";\nimport { getDirection } from \"./direction\";\nimport { predictLoc } from \"./location\";\n\nconst localServer = \"ws://localhost:8888\";\nconst remoteServer = \"ws://104.248.73.89:8888\";// ?????\nconst server = remoteServer;\n\nclass WebSocketManager {\n  constructor() {\n    this.connect();\n  }\n\n    state = {\n      connected: false,\n      lastPacketTime: null,\n      currentData: null,\n    };\n\n    componentDidMount() {\n      this.connect();\n    }\n\n    connect = () => {\n      console.info(\"Connecting....\");\n      const connection = new WebSocket(server);\n\n      connection.onopen = () => {\n        this.setState({ connected: true });\n        console.info(\"Connected to server\");\n      };\n\n      connection.onerror = (error) => {\n        console.error(\n          \"Socket encountered error: \",\n          error.message,\n          \"Closing socket\",\n        );\n        connection.close();\n        console.info(\"Connection error\", error);\n      };\n      connection.onmessage = (e) => {\n        this.receiveData(e.data);\n      };\n      connection.onclose = () => {\n        console.info(\"Disconnected from server\");\n      };\n    };\n\n  receiveData = (rawData) => {\n    const { currentData } = this.state;\n    const data = JSON.parse(rawData);\n    const time = +Date.now();\n    const timeElapsed = time - this.state.lastPacketTime;\n    data.timeElapsed = timeElapsed;\n    this.state.lastPacketTime = time;\n    if (data.flightData) {\n      data.flightData.timeRecieved = (time / 1000) || 0;\n\n      data.flightData.payloadPredictionDistance = predictPayload(data.flightData.altitude, data.flightData.velocity, data.flightData.headwind);\n      data.flightData.CDAPredictionDistance = predictCDA(data.flightData.altitude, data.flightData.velocity, data.flightData.headwind);\n\n      data.flightData.direction = getDirection(currentData.flightData, data.flightData);\n\n      data.flightData.payloadLatLong = predictLoc(data.flightData, data.flightData.payloadPredictionDistance);\n      data.flightData.cdaLatLong = predictLoc(data.flightData, data.flightData.CDAPredictionDistance);\n\n      this.planePositionHistory.push([data.flightData.latitude, data.flightData.longitude]);\n      this.dataLog.push(data.flightData);\n\n      this.setState({ currentData: data });\n    }\n  };\n\n    testData = () => {\n      const { connected } = this.state;\n      if (!connected) {\n        console.warn(\"Cannot send. Not connected\");\n        return;\n      }\n      const data = JSON.stringify(\n        {\n          type: \"data\",\n          flightData: {\n            latitude: 49.258063+Math.random()*0.00111,\n            longitude: -123.195911+Math.random()*0.00111,\n            altitude: 45.3,\n            velocity: 10.3,\n            headwind: -0.9,\n          },\n        },\n      );\n      console.info(\"Sending test data:\", data);\n      this.connection.send(data);\n    };\n\n    ping = () => {\n      const { connected } = this.state;\n      if (!connected) {\n        console.warn(\"Cannot ping. Not connected\");\n        return;\n      }\n      const message = JSON.stringify(\n        {\n          type: \"action\",\n          action: {\n            // ping\n          },\n        },\n      );\n      console.info(\"Pinging:\", message);\n      this.connection.send(message);\n    };\n\n  release = () => {\n    const { connected } = this.state;\n    if (!connected) {\n      console.warn(\"Cannot drop. Not connected\");\n      return;\n    }\n    const message = JSON.stringify(\n      {\n        type: \"action\",\n        action: {\n          // drop details\n        },\n      },\n    );\n    console.info(\"Sending drop signal:\", message);\n    this.connection.send(message);\n  };\n\n  /*\n    check = () => {\n      const { connection } = this.state;\n      if (!connection || connection.readyState == WebSocket.CLOSED) this.connect();\n    };\n    */\n}\nexport default WebSocketManager;\n"]},"metadata":{},"sourceType":"module"}